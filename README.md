# PatreonOJ - åœ¨çº¿åˆ¤é¢˜ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

PatreonOJ æ˜¯ä¸€ä¸ªåŸºäº Go + Gin + GORM çš„åœ¨çº¿åˆ¤é¢˜ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹ï¼Œå…·æœ‰å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ã€é¢˜ç›®ç®¡ç†å’Œä»£ç è¯„æµ‹åŠŸèƒ½ã€‚

## æ–°ç‰¹æ€§

### ğŸ¯ å¤šæ•°æ®åº“æ”¯æŒ
- **MySQL**: é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒçš„é«˜æ€§èƒ½æ•°æ®åº“
- **SQLite**: é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒçš„è½»é‡çº§æ•°æ®åº“

### âš™ï¸ é…ç½®ç®¡ç†
- ä½¿ç”¨ Viper è¿›è¡Œé…ç½®ç®¡ç†
- æ”¯æŒ YAML æ ¼å¼é…ç½®æ–‡ä»¶
- æ”¯æŒç¯å¢ƒå˜é‡å’Œé»˜è®¤å€¼

### ğŸ”§ çµæ´»é…ç½®
- æ•°æ®åº“ç±»å‹å¯é…ç½®åˆ‡æ¢
- æœåŠ¡å™¨ç«¯å£å’Œè¿è¡Œæ¨¡å¼å¯é…ç½®
- è¯„æµ‹æœåŠ¡å‚æ•°å¯é…ç½®
- æ—¥å¿—çº§åˆ«å’Œæ ¼å¼å¯é…ç½®

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

### 2. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `config/config.yaml` æ–‡ä»¶ï¼š

#### ä½¿ç”¨ MySQL
```yaml
database:
  type: "mysql"
  mysql:
    host: "localhost"
    port: 3306
    username: "root"
    password: "your_password"
    dbname: "patreon_oj"
    charset: "utf8mb4"
    parseTime: true
    loc: "Local"
```

#### ä½¿ç”¨ SQLite
```yaml
database:
  type: "sqlite"
  sqlite:
    path: "./data/patreon.db"
```

### 3. å¯åŠ¨æœåŠ¡

```bash
go run main.go
```

æœåŠ¡å™¨å°†åœ¨é…ç½®çš„ç«¯å£å¯åŠ¨ï¼ˆé»˜è®¤ 8080ï¼‰ã€‚

## é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®
- `database.type`: æ•°æ®åº“ç±»å‹ï¼Œæ”¯æŒ "mysql" æˆ– "sqlite"
- `database.mysql.*`: MySQL ç›¸å…³é…ç½®
- `database.sqlite.path`: SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„

### æœåŠ¡å™¨é…ç½®
- `server.port`: æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ 8080ï¼‰
- `server.mode`: Gin è¿è¡Œæ¨¡å¼ï¼ˆdebug/release/testï¼‰

### è¯„æµ‹æœåŠ¡é…ç½®
- `judge.api_url`: è¯„æµ‹æœåŠ¡ API åœ°å€
- `judge.timeout`: è¯„æµ‹è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
- `judge.queue_size`: è¯„æµ‹é˜Ÿåˆ—å¤§å°

### æ—¥å¿—é…ç½®
- `log.level`: æ—¥å¿—çº§åˆ«ï¼ˆdebug/info/warn/errorï¼‰
- `log.format`: æ—¥å¿—æ ¼å¼ï¼ˆjson/textï¼‰
- `log.output`: æ—¥å¿—è¾“å‡ºï¼ˆstdout/fileï¼‰

## API æ¥å£

### ç”¨æˆ·ç®¡ç†
- `POST /admin/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /admin/login` - ç”¨æˆ·ç™»å½•
- `POST /admin/logout` - ç”¨æˆ·æ³¨é”€
- `GET /admin/user` - è·å–ç”¨æˆ·åˆ—è¡¨

### é¢˜ç›®ç®¡ç†
- `GET /admin/question` - è·å–é¢˜ç›®åˆ—è¡¨
- `POST /admin/question` - åˆ›å»ºé¢˜ç›®
- `POST /admin/question/:id` - æ›´æ–°é¢˜ç›®

### åˆ†ç±»ç®¡ç†
- `GET /admin/category` - è·å–åˆ†ç±»åˆ—è¡¨
- `POST /admin/category` - åˆ›å»ºåˆ†ç±»
- `POST /admin/category/:id` - æ›´æ–°åˆ†ç±»

### ä»£ç è¯„æµ‹
- `POST /admin/submit` - æäº¤ä»£ç 
- `GET /admin/submission/:id` - è·å–æäº¤ç»“æœ

## é¡¹ç›®ç»“æ„

```
PatreonOJ/
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶å’Œé…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ config.yaml        # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.go          # é…ç½®ç»“æ„ä½“å’Œåˆå§‹åŒ–
â”œâ”€â”€ Controllers/           # æ§åˆ¶å™¨å±‚
â”‚   â””â”€â”€ admin/            # ç®¡ç†å‘˜æ§åˆ¶å™¨
â”œâ”€â”€ models/               # æ•°æ®æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ core.go          # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ *.go             # å„ç§æ•°æ®æ¨¡å‹
â”œâ”€â”€ routers/             # è·¯ç”±å±‚
â”œâ”€â”€ services/            # æœåŠ¡å±‚
â””â”€â”€ main.go             # ç¨‹åºå…¥å£
```

## å¼€å‘è¯´æ˜

### æ•°æ®åº“è¿ç§»
ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¡¨è¿ç§»ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»ºè¡¨ç»“æ„ã€‚

### æ·»åŠ æ–°æ¨¡å‹
1. åœ¨ `models/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æ¨¡å‹æ–‡ä»¶
2. åœ¨ `models/core.go` çš„ `AutoMigrate()` å‡½æ•°ä¸­æ·»åŠ æ–°æ¨¡å‹

### ç¯å¢ƒåˆ‡æ¢
é€šè¿‡ä¿®æ”¹ `config/config.yaml` ä¸­çš„ `database.type` å­—æ®µå³å¯åˆ‡æ¢æ•°æ®åº“ç±»å‹ï¼š
- å¼€å‘ç¯å¢ƒï¼šæ¨èä½¿ç”¨ SQLite
- ç”Ÿäº§ç¯å¢ƒï¼šæ¨èä½¿ç”¨ MySQL

## æ³¨æ„äº‹é¡¹

1. **SQLite æ•°æ®åº“æ–‡ä»¶**: ç¡®ä¿ SQLite æ•°æ®åº“æ–‡ä»¶çš„ç›®å½•å…·æœ‰å†™æƒé™
2. **MySQL è¿æ¥**: ç¡®ä¿ MySQL æœåŠ¡æ­£åœ¨è¿è¡Œä¸”è¿æ¥ä¿¡æ¯æ­£ç¡®
3. **é…ç½®æ–‡ä»¶**: é¦–æ¬¡è¿è¡Œå‰è¯·æ£€æŸ¥å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³å‚æ•°
4. **ç«¯å£å ç”¨**: ç¡®ä¿é…ç½®çš„ç«¯å£æœªè¢«å…¶ä»–ç¨‹åºå ç”¨

## æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Gin
- **ORM**: GORM
- **æ•°æ®åº“**: MySQL / SQLite
- **é…ç½®ç®¡ç†**: Viper
- **UUID**: Google UUID
- **æ¨¡æ¿å¼•æ“**: Go HTML Template